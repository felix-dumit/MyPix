<% provide(:title, @user.name) %>

<h1>
  <%= gravatar_for @user %>
  <%= @user.name %>
</h1>
<h2> <%= @user.email %> </h2>

<% friend_count = 0 %>
<% @user.friends.each do |friend| %>
<% friend_count++ if friend.friends.include? @user %>
<% end %>
<% end %>

<h2> Your Friends </h2>
You have <%= pluralize(friend_count, 'friend') %>
<ul>
<% @user.friends.each do |friend| %>
<% if friend.friends.include? @user %>
<br /><li><%= link_to friend.name, friend %>
(<%= link_to "remove", @user.friendships.find_by_friend_id(friend.id), :method => :delete, :confirm => "Are you sure?" %>)
</li>
<% end %>
<% end %>
</ul>

<h2> Your Received Requests </h2>
You have <%= pluralize(@user.inverse_friendships.count - friend_count, 'friend') %> pending
<ul>
<% @user.inverse_friendships.each do |inverse_friendship| %>
<% unless @user.friends.include? inverse_friendship.user %>
<br /><li><%= link_to inverse_friendship.user.name, inverse_friendship.user %>
(<%= link_to "decline", inverse_friendship, :method => :delete %>)
(<%= link_to "accept", friendships_path(:friend_id => inverse_friendship.user), :method => :post %>)
</li>
<% end %>
<% end %>
</ul>

<h2> Your Sent Requests </h2>
You have sent <%= pluralize(@user.friendships.count - friend_count , 'request') %> 
<ul>
<% @user.friendships.each do |friendship| %>
<% unless friendship.friend.friends.include? @user %>
<br /><li><%= link_to friendship.friend.name, friendship.friend %>
(<%= link_to "remove", friendship, :method => :delete, :confirm => "Are you sure?" %>)
</li>
<% end %>
<% end %>
</ul>

</div>
